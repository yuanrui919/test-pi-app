<!DOCTYPE html>
<html>
	<head>
        <meta charset="UTF-8">
        <title>測試</title>
        
        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <script src="https://sdk.minepi.com/pi-sdk.js"></script>
        <script type="text/javascript">
            $( document ).ready(function() {
                const Pi = window.Pi;
                Pi.init({ version: "2.0", sandbox: true });
                
                async function auth() {
                    try {
                        // Identify the user with their username / unique network-wide ID, and get permission to request payments from them.
                        const scopes = ['username', 'payments'];
                        function onIncompletePaymentFound(payment) {
                           console.log(payment);
                        }; // Read more about this in the SDK reference

                        Pi.authenticate(scopes, onIncompletePaymentFound).then(function(auth) {
                            console.log(auth);
                            $("#username").html(" " + auth.user.username);
                        }).catch(function(error) {
                            //Pi.openShareDialog("Error", error);
                            //alert(err);
                            console.error(error);
                        });
                    } catch (err) {
                        //Pi.openShareDialog("Error", err);
                        //alert(err);
                        console.error(err);
                        // Not able to fetch the user
                    }
                }
                
                auth();
                
                const shareData = {
                    title: '分享Pi Network雜記',
                    text: '歡迎分享連結。https://yuanrui919.github.io/',
                    //url: 'https://latin-chain.com/',
                }

                //$("#social_div").css("visibility", "visible");
                const btn = document.querySelector('#button1');
                //const resultPara = document.querySelector('.result');
                
                // Must be triggered some kind of "user activation"
                btn.addEventListener('click', async () => {
                    if (!navigator.share) {
                        Pi.openShareDialog(shareData.title, shareData.text);
                    }else
                    {
                      try {
                        await navigator.share(shareData);
                        //resultPara.textContent = 'MDN shared successfully'
                      } catch(err) {
                        //alert('Error: ' + err);
                      }
                    }
                });
                
            });

        </script>
	</head>
	<body>
        
        <div class="container" style="text-align:center">
            <br/>Hi<strong><span id="username"></span></strong>. 歡迎光臨。
            <br/><br/>
            <div id="social_div">把我分享出去吧：<br/><br/>
            <button id="button1" class="btn btn-primary">Share</button><br/><br/>
            </div>
		</div>
	</body>
</html>
